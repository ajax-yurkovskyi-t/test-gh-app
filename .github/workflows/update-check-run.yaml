name: Update Check Run

on:
  workflow_dispatch:
    inputs:
      target-repo:
        description: 'Target repository name'
        required: true
      target-pr-number:
        description: 'Target Pr Number'
        required: true
      check-run-ids:
        description: 'Target Pr Number'
        required: false
      conclusion:
        description: 'Target Pr Number'
        required: false

permissions:
  actions: write
  checks: write
  contents: read
  pull-requests: write

jobs:
  update-check-run:
    runs-on: ubuntu-latest

    steps:
      - name: Generate a token
        id: generate-app-token
        continue-on-error: true
        uses: actions/create-github-app-token@v1.9.3
        with:
          app-id: ${{ secrets.GH_APP_ID }}
          private-key: ${{ secrets.JAVA_BACKEND_APP_PRIVATE_KEY }}
          owner: ${{ github.repository_owner }}

      - name: Update check run
        uses: ajax-yurkovskyi-t/test-gh-app/.github/actions/update-check-run@feature/emptyness
        with:
          target-repo: ${{ inputs.target-repo }}
          conclusion: ${{ inputs.conclusion }}
          check-run-ids: ${{ inputs.check-run-ids }}
          target-pr-number: ${{ inputs.target-pr-number }}
          github-token: ${{ steps.generate-app-token.outputs.token }}
